---
title: Xarray
description: Xarray library, common use-cases and how they can be implemented easily.
icon: chart-bar
---

[Xarray](https://xarray.dev/) is a library for working with labelled multi-dimensional arrays.
Xarray is built on top of [NumPy](https://numpy.org/) and [Pandas](https://pandas.pydata.org/). Xarray introduces labels in
the form of dimensions, coordinates and attributes on top of raw NumPy-like arrays, which allows for a more intuitive,
more concise, and less error-prone developer experience. The package includes a large and growing library of
domain-agnostic functions for advanced analytics and visualization with these data structures.

<Frame>
  <img src="/assets/xarray/xarray-datastructure.png" alt="Overview of the Xarray data structure" />
</Frame>

<Note>
  A good overview of the Xarray library and why it's a perfect fit for N-dimensional data (such as Tilebox time series
  datasets) can be found in the official [Why Xarray? documentation
  page](https://xarray.pydata.org/en/stable/why-xarray.html).
</Note>

The Tilebox Python client provides access to your satellite data in the form of a
[xarray.Dataset](https://docs.xarray.dev/en/stable/generated/xarray.Dataset.html#xarray.Dataset). This brings a great
number of benefits compared to custom Tilebox specific data structures such as:

- **Familiarity**: Xarray is built on top of NumPy and Pandas, which are two of the most popular Python libraries for
  scientific computing. If you are already familiar with these libraries, you are right at home with Xarray.
- **Performance**: By using NumPy under the hood, which in turn is built on top of C and Fortran, Xarray benefits from
  all the performance optimizations that those libraries offer. This means that Xarray is fast and can handle large
  datasets with ease.
- **Interoperability**: Xarray is a popular library and is used by many other libraries. This means that you can
  easily integrate Xarray into your existing workflows. Many third party libraries are available to extend Xarray
  with more capability for different use cases.
- **Flexibility**: Xarray is a flexible library and can be used for a wide range of use-cases. It's also
  easy to extend Xarray with custom capability.

## An example dataset

To get an understanding of how Xarray works, a simple example dataset is used, as it could be returned by a
[Tilebox timeseries dataset](/timeseries).

<CodeGroup>

```python Python (Sync)
from tilebox.datasets import Client

client = Client()
datasets = client.datasets()
collection = datasets.open_data.asf.sentinel1_sar.collection("Sentinel-1A")
satellite_data = collection.load(("2022-05-01", "2022-06-01"), show_progress=True)
print(satellite_data)
```

```python Python (Async)
from tilebox.datasets.aio import Client

client = Client()
datasets = await client.datasets()
collection = datasets.open_data.asf.sentinel1_sar.collection("Sentinel-1A")
satellite_data = await collection.load(("2022-05-01", "2022-06-01"), show_progress=True)
print(satellite_data)
```

</CodeGroup>

```txt Output
<xarray.Dataset> Size: 8MB
Dimensions:              (time: 16507, latlon: 2, n_footprint: 5)
Coordinates:
    ingestion_time       (time) datetime64[ns] 132kB 2023-10-20T10:04:07 ... ...
    id                   (time) <U36 2MB '01808083-57c8-d563-1a35-f39fb6a4c1c...
  * time                 (time) datetime64[ns] 132kB 2022-05-01T16:45:33 ... ...
  * latlon               (latlon) <U9 72B 'latitude' 'longitude'
Dimensions without coordinates: n_footprint
Data variables: (12/19)
    granule_name         (time) object 132kB 'S1A_IW_RAW__0SDV_20220501T16453...
    processing_level     (time) <U2 132kB 'L0' 'L0' 'L0' 'L0' ... 'L0' 'L0' 'L0'
    group                (time) object 132kB 'S1A_IWDV_0184_0191_043020_073' ...
    orbit                (time) int64 132kB 43020 43020 43020 ... 43462 43462
    path                 (time) int64 132kB 73 73 73 73 73 ... 165 165 165 165
    frame                (time) int64 132kB 184 189 194 199 204 ... 49 54 59 64
    ...                   ...
    md5sum               (time) object 132kB '121e427a0236dbb9b13c6751d57827e...
    quicklook_available  (time) bool 17kB False False False ... False False
    polarization         (time) <U7 462kB 'VV_VH' 'VV_VH' ... 'VV_VH' 'VV_VH'
    acquisition_mode     (time) <U9 594kB 'IW' 'IW' 'IW' 'IW' ... 'IW' 'IW' 'IW'
    insar_stack_id       (time) int64 132kB 0 0 0 0 0 0 0 0 ... 0 0 0 0 0 0 0 0
    insar_baseline       (time) float64 132kB 0.0 0.0 0.0 0.0 ... 0.0 0.0 0.0
Attributes:
    Dataset:  Copernicus Sentinel data 2022. Downloaded from ASF DAAC on 20/1...
```

<Note>
  This is a simple dataset that was generated to showcase some common Xarray use-cases. If you want to follow along, you
  can <a href="/data/example_satellite_data.nc">download the dataset as a NetCDF file</a>. The [Reading and writing
  files section](/sdks/python/xarray#reading-and-writing-files) explains how to save and load Xarray datasets to and
  from NetCDF files.
</Note>

Here is a breakdown of the preceding output:

- `satellite_data` **dataset** contains different **dimensions**, **coordinates** and **variables**
- `time` **dimension** consists of 570396 elements. This means there are 570396 data points in the dataset
- `time` **dimension coordinate** contains datetime values. This is the time when the data was measured.
  The `*` mark shows that it's a dimension coordinate. Dimension coordinates are used for label based
  indexing and alignment, it means you can use the time to access individual data points in the dataset
- `ingestion_time` **non-dimension coordinate** contains datetime values. This is the time when the data was
  ingested into the Tilebox database. Non-dimension coordinates are variables that contain coordinate data, but are not
  used for label based indexing and alignment. They can [even be multidimensional](https://docs.xarray.dev/en/stable/examples/multidimensional-coords.html).
- `sensor` **variable** contains integers. This variable tells you which sensor produced a given measurement.
  A sensor in this case is identified by a number, `1` or `2` in the example dataset
- `measurement` **variable** contains floating point values. This variable contains the actual measurement values.

<Note>
  Check out the [xarray terminology overview](https://docs.xarray.dev/en/stable/user-guide/terminology.html) to deepen
  your understanding of **datasets**, **dimensions**, **coordinates**, and **variables**.
</Note>

The examples below showcase some of the most common use-cases for Xarray. Since the data is already loaded into memory,
no more API requests are required, there is no difference between the sync and async Client in the examples below.

## Accessing data in a dataset

### Accessing by index

There a couple of different ways that you can access data in a dataset. The Xarray documentation provides a
[great overview](https://docs.xarray.dev/en/stable/user-guide/indexing.html) of all those methods.

You can access the `measurement` variable:

```python Accessing values
# Let's print the first measurement value
print(satellite_data.measurement[0])
```

```txt Output
<xarray.DataArray 'measurement' ()> array(3.07027067) Coordinates:
ingestion_time datetime64[ns] 2017-01-01T15:26:32 time datetime64[ns]
2017-01-01T02:45:35
```

You can see in the preceding output that the first measurement value is `3.07027067`, but the output is not just a plain
`float` containing that value. Instead it's an `xarray.DataArray` object. This is because that way you can still
access the coordinates belonging to that value. To get the plain python object you can use the `item()` method:

```python Accessing raw values
measurement = satellite_data.measurement[0].item()
print(measurement)
```

```python Output
3.070270667590244
```

You can access coordinates in a similar manner. For datetime fields Xarray additionally offers a special `dt` (datetime)
accessor, which you can use to format the time as a string:

```python Accessing and formatting datetime fields
time_format = "%Y-%m-%d %H:%M:%S"
time = satellite_data.time[0].dt.strftime(time_format).item()
ingestion_time = satellite_data.ingestion_time[0].dt.strftime(time_format).item()
print(f"Measurement 0 was taken at {time} and ingested at {ingestion_time}")
```

```txt Output
Measurement 0 was taken at 2017-01-01 02:45:35 and ingested at 2017-01-01
15:26:32
```

Similarly you can also retrieve a whole dataset containing all variables and coordinates for a single data point in the
example dataset. For this Xarray offers the `isel` method (it stands for index selection):

```python Accessing a whole datapoint by index
datapoint = satellite_data.isel(time=0)
print(datapoint)
```

```txt Output
<xarray.Dataset>
  Dimensions: () Coordinates: ingestion_time datetime64[ns] 2017-01-01T15:26:32
  time datetime64[ns] 2017-01-01T02:45:35 Data variables: sensor int64 2
  measurement float64 3.07
</xarray.Dataset>
```

### Subsets of data

You can also access a subsets of the data.
Here are a couple of ways you can retrieve the first 3 and last 3 measurements.

```python Accessing raw values
# individual variables
first_3_measurements = satellite_data.measurement[0:3]
print("First 3 measurements", first_3_measurements.values)
last_3_measurements = satellite_data.measurement[-3:]
print("Last 3 measurements", last_3_measurements.values)

# whole sub datasets
first_3 = satellite_data.isel(time=slice(0, 3))
last_3 = satellite_data.isel(time=slice(-3, None))
print("Sub dataset of the last 3 datapoints")
print(last_3)
```

```txt Output
First 3 measurements [3.07027067 2.42966457 3.58839564] Last 3 measurements
[1.4907412 2.04492377 2.79836407] Sub dataset of the last 3 datapoints
<xarray.Dataset>
  Dimensions: (time: 3) Coordinates: ingestion_time (time) datetime64[ns]
  2022-12-31T20:56:40 ... 2022-12-31T... * time (time) datetime64[ns]
  2022-12-31T15:47:54 ... 2022-12-31T... Data variables: sensor (time) int64 1 2
  1 measurement (time) float64 1.491 2.045 2.798
</xarray.Dataset>
```

## Filtering data

Xarray also offers a convenient way of filtering a dataset based on a condition.
For example, you can filter the dataset to only look at measurements taken by sensor `1`.

```python Filtering data by sensor
measurements_by_sensor_1 = satellite_data.measurement[satellite_data.sensor == 1]
print(measurements_by_sensor_1)
```

```txt Output
<xarray.DataArray 'measurement' (time: 389100)> array([3.58839564e+00,
2.70314237e+00, 3.27767130e-03, ..., 2.83278085e+00, 1.49074120e+00,
2.79836407e+00]) Coordinates: ingestion_time (time) datetime64[ns]
2017-01-01T15:26:32 ... 2022-12-31T... * time (time) datetime64[ns]
2017-01-01T02:54:03 ... 2022-12-31T...
```

You can combine conditions, e.g. to filter for measurement values between `1.5` and `1.6` taken by sensor `1`:

```python Filtering data by sensor and measurement value
data_filter = (
    (satellite_data.sensor == 1) &
    (satellite_data.measurement > 1.5) &
    (satellite_data.measurement < 1.6)
)
filtered_measurements = satellite_data.measurement[data_filter]
print(filtered_measurements)
```

```txt Output
<xarray.DataArray 'measurement' (time: 6005)> array([1.54675131, 1.58851704,
1.52978976, ..., 1.54684979, 1.58256101, 1.5325089 ]) Coordinates:
ingestion_time (time) datetime64[ns] 2017-01-01T05:21:17 ... 2022-12-31T... *
time (time) datetime64[ns] 2017-01-01T18:17:47 ... 2022-12-31T...
```

## Selecting data by value

You can use the values of a primary coordinate to index your dataset.
For example, you can access the measurement value taken at `2021-01-14 07:21:04`:

```python Indexing by time
specific_measurement = satellite_data.sel(time="2021-01-14T07:21:04")
print(specific_measurement)
```

```txt Output
<xarray.Dataset>
  Dimensions: () Coordinates: ingestion_time datetime64[ns] 2020-12-27T18:30:47
  time datetime64[ns] 2021-01-14T07:21:04 Data variables: sensor int64 1
  measurement float64 3.873
</xarray.Dataset>
```

When trying to access a value that is not in the dataset, a `KeyError` is raised.

```python Indexing by time (not found)
nearest_measurement = satellite_data.sel(time="2021-01-14T07:21:05")
>>> raises KeyError: "2021-01-14T07:21:05"
```

The `method` parameter can be used to return the closest value instead of raising an error.

```python Finding the closest measurement
nearest_measurement = satellite_data.sel(time="2021-01-14T07:21:05", method="nearest")
assert nearest_measurement.equals(specific_measurement)  # passes
```

<Note>
  Indexing requires the coordinate values to be unique. If there are duplicated values, Xarray raises an error, because
  it can not determine which value to return. An easy way to avoid this is to
  [drop_duplicates](https://docs.xarray.dev/en/stable/generated/xarray.Dataset.drop_duplicates.html) before indexing.
  `satellite_data = satellite_data.drop_duplicates("time")`
</Note>

## Statistics

Xarray and NumPy offer a wide range of statistical functions that can be applied to a dataset or a DataArray. Here are
a few examples:

```python Computing dataset statistics
measurements = satellite_data.measurement
min_meas = measurements.min().item()
max_meas = measurements.max().item()
mean_meas = measurements.mean().item()
std_meas = measurements.std().item()
print(f"Measurements from {min_meas:.2f} to {max_meas:.2f} with mean {mean_meas:.2f} and a std of {std_meas:.2f}")
```

```txt Output
Measurements from 0.00 to 4.00 with mean 1.91 and a std of 1.44
```

You can also use many NumPy functions directly on a dataset or DataArray. For example, to find out which sensors
you are dealing with, you can use [np.unique](https://numpy.org/doc/stable/reference/generated/numpy.unique.html) to
get all the unique values in the `sensor` data array.

```python Finding unique values
import numpy as np
print("Sensors:", np.unique(satellite_data.sensor))
```

```txt Output
Sensors: [1 2]
```

## Reading and writing files

Xarray also offers a convenient way to save and load datasets to and from files. This is especially useful if you want
to share your data with others or if you want to persist your data for later use. Xarray supports a wide range of file
formats, including NetCDF, Zarr, GRIB, and many more. For a full list of supported formats, please refer to the
[official documentation page](https://docs.xarray.dev/en/stable/user-guide/io.html).

Here is how you can save the example dataset to a NetCDF file:

```python Saving a dataset to a file
satellite_data.to_netcdf("example_satellite_data.nc")
```

It creates a file called `example_satellite_data.nc` in the current directory. You can now load this file back
into memory:

```python Loading a dataset from a file
import xarray as xr

satellite_data = xr.open_dataset("example_satellite_data.nc")
```

In case you want to follow along with the examples in this section, you can download the example dataset as a NetCDF
file <a href="/data/example_satellite_data.nc">here</a>.

## Further reading

This section only covered a few of the most common use-cases for Xarray. Xarray offers many more functions and features.
For more information, please refer to the [Xarray documentation](https://xarray.pydata.org/en/stable/)
or check out the [Xarray Tutorials](https://tutorial.xarray.dev/intro.html).

Some useful capability that this section did not cover include:

- [Grouping data](https://docs.xarray.dev/en/stable/user-guide/groupby.html)
- [Computation](https://docs.xarray.dev/en/stable/user-guide/computation.html)
- [Time series specific functionality](https://docs.xarray.dev/en/stable/user-guide/time-series.html)
- [Interpolation](https://docs.xarray.dev/en/latest/user-guide/interpolation.html)
- [Plotting](https://docs.xarray.dev/en/latest/user-guide/plotting.html)
